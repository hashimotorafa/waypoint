# syntax=docker/dockerfile:1.6
FROM ruby:3.3

ARG NODE_VERSION=20

RUN apt-get update -qq \
    && apt-get install -y --no-install-recommends \
       build-essential \
       libpq-dev \
       git \
       curl \
       vim \
       ca-certificates \
       gnupg \
    && curl -fsSL https://deb.nodesource.com/setup_${NODE_VERSION}.x | bash - \
    && apt-get install -y --no-install-recommends nodejs \
    && npm install --global yarn \
    && apt-get clean \
    && rm -rf /var/lib/apt/lists/*

ENV APP_HOME=/app \
    GEM_HOME=/bundle \
    BUNDLE_PATH=/bundle \
    BUNDLE_BIN=/bundle/bin
ENV PATH="${BUNDLE_BIN}:${PATH}"

RUN gem update --system --no-document \
    && gem install bundler --no-document \
    && gem install rails --no-document

WORKDIR ${APP_HOME}

COPY docker/entrypoint.sh /usr/bin/entrypoint.sh
RUN chmod +x /usr/bin/entrypoint.sh

ENTRYPOINT ["entrypoint.sh"]
CMD ["bash"]
